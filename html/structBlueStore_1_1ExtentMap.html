<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ceph-doxygen: BlueStore::ExtentMap Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ceph-doxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="classBlueStore.html">BlueStore</a></li><li class="navelem"><a class="el" href="structBlueStore_1_1ExtentMap.html">ExtentMap</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="structBlueStore_1_1ExtentMap-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">BlueStore::ExtentMap Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>a sharded extent map, mapping offsets to lextents to blobs  
 <a href="structBlueStore_1_1ExtentMap.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="BlueStore_8h_source.html">BlueStore.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for BlueStore::ExtentMap:</div>
<div class="dyncontent">
<div class="center"><img src="structBlueStore_1_1ExtentMap__coll__graph.png" border="0" usemap="#aBlueStore_1_1ExtentMap_coll__map" alt="Collaboration graph"/></div>
<map name="aBlueStore_1_1ExtentMap_coll__map" id="aBlueStore_1_1ExtentMap_coll__map">
<area shape="rect" title="a sharded extent map, mapping offsets to lextents to blobs" alt="" coords="1041,67,1204,93"/>
<area shape="rect" href="structBlueStore_1_1Onode.html" title="an in&#45;memory object" alt="" coords="1335,115,1469,141"/>
<area shape="rect" href="structBlueStore_1_1Collection.html" title=" " alt="" coords="1043,135,1202,161"/>
<area shape="rect" title=" " alt="" coords="731,5,847,32"/>
<area shape="rect" href="structbluestore__cnode__t.html" title="collection metadata" alt="" coords="718,56,859,83"/>
<area shape="rect" href="structBlueStore_1_1BufferCacheShard.html" title="A Generic buffer Cache Shard." alt="" coords="461,91,671,117"/>
<area shape="rect" href="structBlueStore_1_1CacheShard.html" title="A generic Cache Shard." alt="" coords="5,105,176,132"/>
<area shape="rect" href="structBlueStore_1_1OnodeCacheShard.html" title="A Generic onode Cache Shard." alt="" coords="225,131,437,157"/>
<area shape="rect" href="classBlueStore.html" title=" " alt="" coords="746,224,831,251"/>
<area shape="rect" title=" " alt="" coords="282,181,381,208"/>
<area shape="rect" title=" " alt="" coords="266,232,397,259"/>
<area shape="rect" href="structBlueStore_1_1BSPerfTracker.html" title=" " alt="" coords="240,283,423,309"/>
<area shape="rect" href="classBlueStore_1_1BlueStoreThrottle.html" title=" " alt="" coords="228,333,435,360"/>
<area shape="rect" href="structBlueStore_1_1OnodeSpace.html" title=" " alt="" coords="701,169,876,196"/>
<area shape="rect" href="structBlueStore_1_1SharedBlobSet.html" title="a lookup table of SharedBlobs" alt="" coords="695,275,883,301"/>
<area shape="rect" href="structbluestore__onode__t.html" title="onode: per&#45;object metadata" alt="" coords="1051,185,1194,212"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap_1_1debug__au__state__t.html">debug_au_state_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocation unit status  <a href="structBlueStore_1_1ExtentMap_1_1debug__au__state__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap_1_1DeleteDisposer.html">DeleteDisposer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBlueStore_1_1ExtentMap_1_1ExtentDecoder.html">ExtentDecoder</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBlueStore_1_1ExtentMap_1_1ExtentDecoderFull.html">ExtentDecoderFull</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap_1_1Shard.html">Shard</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ac785bec4e41c6bf9e36409eedc5934e8"><td class="memItemLeft" align="right" valign="top"><a id="ac785bec4e41c6bf9e36409eedc5934e8"></a>
typedef boost::intrusive_ptr&lt; <a class="el" href="structBlueStore_1_1Onode.html">Onode</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><b>OnodeRef</b></td></tr>
<tr class="separator:ac785bec4e41c6bf9e36409eedc5934e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f7a36d616910a8820428b4c6dcf0b27"><td class="memItemLeft" align="right" valign="top"><a id="a2f7a36d616910a8820428b4c6dcf0b27"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>debug_au_vector_t</b> = std::vector&lt; <a class="el" href="structBlueStore_1_1ExtentMap_1_1debug__au__state__t.html">debug_au_state_t</a> &gt;</td></tr>
<tr class="separator:a2f7a36d616910a8820428b4c6dcf0b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acf7b1bb785235cf8ca4f681cc2e78352"><td class="memItemLeft" align="right" valign="top"><a id="acf7b1bb785235cf8ca4f681cc2e78352"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>scan_shared_blobs</b> (uint64_t start, uint64_t length, std::multimap&lt; uint64_t, <a class="el" href="structBlueStore_1_1Blob.html">Blob</a> * &gt; &amp;candidates)</td></tr>
<tr class="separator:acf7b1bb785235cf8ca4f681cc2e78352"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc2892c03f901995462e62784ac660b8"><td class="memItemLeft" align="right" valign="top"><a id="abc2892c03f901995462e62784ac660b8"></a>
<a class="el" href="structBlueStore_1_1Blob.html">Blob</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>find_mergable_companion</b> (<a class="el" href="structBlueStore_1_1Blob.html">Blob</a> *blob_to_dissolve, uint32_t blob_start, uint32_t &amp;blob_width, std::multimap&lt; uint64_t, <a class="el" href="structBlueStore_1_1Blob.html">Blob</a> * &gt; &amp;candidates)</td></tr>
<tr class="separator:abc2892c03f901995462e62784ac660b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f4e56481e2c991847ecc37c7e1a8d51"><td class="memItemLeft" align="right" valign="top"><a id="a9f4e56481e2c991847ecc37c7e1a8d51"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>reblob_extents</b> (uint32_t blob_start, uint32_t blob_end, BlobRef from_blob, BlobRef to_blob)</td></tr>
<tr class="separator:a9f4e56481e2c991847ecc37c7e1a8d51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae486d22a22ac470b0998761ecfbbdbd9"><td class="memItemLeft" align="right" valign="top"><a id="ae486d22a22ac470b0998761ecfbbdbd9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>make_range_shared_maybe_merge</b> (<a class="el" href="structBlueStore_1_1TransContext.html">TransContext</a> *txc, OnodeRef &amp;onode, uint64_t srcoff, uint64_t length)</td></tr>
<tr class="separator:ae486d22a22ac470b0998761ecfbbdbd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b3232493e40f36c7b2bd1d1182bbb3"><td class="memItemLeft" align="right" valign="top"><a id="a62b3232493e40f36c7b2bd1d1182bbb3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dup</b> (<a class="el" href="classBlueStore.html">BlueStore</a> *b, <a class="el" href="structBlueStore_1_1TransContext.html">TransContext</a> *, CollectionRef &amp;, OnodeRef &amp;, OnodeRef &amp;, uint64_t &amp;, uint64_t &amp;, uint64_t &amp;)</td></tr>
<tr class="separator:a62b3232493e40f36c7b2bd1d1182bbb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5945a7a9596af69a1fd16958d47bcfb7"><td class="memItemLeft" align="right" valign="top"><a id="a5945a7a9596af69a1fd16958d47bcfb7"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dup_esb</b> (<a class="el" href="classBlueStore.html">BlueStore</a> *b, <a class="el" href="structBlueStore_1_1TransContext.html">TransContext</a> *, CollectionRef &amp;, OnodeRef &amp;, OnodeRef &amp;, uint64_t &amp;, uint64_t &amp;, uint64_t &amp;)</td></tr>
<tr class="separator:a5945a7a9596af69a1fd16958d47bcfb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3297e777f24fee80d81291892a441b7b"><td class="memItemLeft" align="right" valign="top"><a id="a3297e777f24fee80d81291892a441b7b"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>needs_reshard</b> () const</td></tr>
<tr class="separator:a3297e777f24fee80d81291892a441b7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5e4e1371fe1bec55d7fdb31c7e0b953"><td class="memItemLeft" align="right" valign="top"><a id="ad5e4e1371fe1bec55d7fdb31c7e0b953"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>clear_needs_reshard</b> ()</td></tr>
<tr class="separator:ad5e4e1371fe1bec55d7fdb31c7e0b953"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b6b3ced14e163bb736f31001964b32c"><td class="memItemLeft" align="right" valign="top"><a id="a4b6b3ced14e163bb736f31001964b32c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>request_reshard</b> (uint32_t begin, uint32_t end)</td></tr>
<tr class="separator:a4b6b3ced14e163bb736f31001964b32c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a339d3a15ecb1db289acefcf4217d610d"><td class="memItemLeft" align="right" valign="top"><a id="a339d3a15ecb1db289acefcf4217d610d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>maybe_reshard</b> (uint32_t begin, uint32_t end)</td></tr>
<tr class="separator:a339d3a15ecb1db289acefcf4217d610d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4bd05c8ddf9ddbf3d56aec3c179a3e1"><td class="memItemLeft" align="right" valign="top"><a id="ad4bd05c8ddf9ddbf3d56aec3c179a3e1"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>ExtentMap</b> (<a class="el" href="structBlueStore_1_1Onode.html">Onode</a> *o, size_t inline_shard_prealloc_size)</td></tr>
<tr class="separator:ad4bd05c8ddf9ddbf3d56aec3c179a3e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affed2cbe9e75abad623b315fdc2d6218"><td class="memItemLeft" align="right" valign="top"><a id="affed2cbe9e75abad623b315fdc2d6218"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>clear</b> ()</td></tr>
<tr class="separator:affed2cbe9e75abad623b315fdc2d6218"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1377d637acadf0d833fc55156a37412b"><td class="memItemLeft" align="right" valign="top"><a id="a1377d637acadf0d833fc55156a37412b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>dump</b> (ceph::Formatter *f) const</td></tr>
<tr class="separator:a1377d637acadf0d833fc55156a37412b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab96bc041907e87a6a833e474c5720ad3"><td class="memItemLeft" align="right" valign="top"><a id="ab96bc041907e87a6a833e474c5720ad3"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>encode_some</b> (uint32_t offset, uint32_t length, ceph::buffer::list &amp;bl, unsigned *pn)</td></tr>
<tr class="separator:ab96bc041907e87a6a833e474c5720ad3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90676acf86467a7c7d70ed4822dc8da7"><td class="memItemLeft" align="right" valign="top"><a id="a90676acf86467a7c7d70ed4822dc8da7"></a>
unsigned&#160;</td><td class="memItemRight" valign="bottom"><b>decode_some</b> (ceph::buffer::list &amp;bl)</td></tr>
<tr class="separator:a90676acf86467a7c7d70ed4822dc8da7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a074b599ca4fc5af7e1eb7c1276637c68"><td class="memItemLeft" align="right" valign="top"><a id="a074b599ca4fc5af7e1eb7c1276637c68"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>bound_encode_spanning_blobs</b> (size_t &amp;p)</td></tr>
<tr class="separator:a074b599ca4fc5af7e1eb7c1276637c68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd356ea5f874bb09595ba8145ce11bb3"><td class="memItemLeft" align="right" valign="top"><a id="afd356ea5f874bb09595ba8145ce11bb3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>encode_spanning_blobs</b> (ceph::buffer::list::contiguous_appender &amp;p)</td></tr>
<tr class="separator:afd356ea5f874bb09595ba8145ce11bb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac240b342090e75110474fff917730b8e"><td class="memItemLeft" align="right" valign="top"><a id="ac240b342090e75110474fff917730b8e"></a>
BlobRef&#160;</td><td class="memItemRight" valign="bottom"><b>get_spanning_blob</b> (int id)</td></tr>
<tr class="separator:ac240b342090e75110474fff917730b8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a667654a1b19c13c1f5dcc8473b328251"><td class="memItemLeft" align="right" valign="top"><a id="a667654a1b19c13c1f5dcc8473b328251"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>update</b> (KeyValueDB::Transaction t, bool force)</td></tr>
<tr class="separator:a667654a1b19c13c1f5dcc8473b328251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9031ef7f8d898eecf5f5cccb93fa80d"><td class="memItemLeft" align="right" valign="top"><a id="ab9031ef7f8d898eecf5f5cccb93fa80d"></a>
decltype(<a class="el" href="structBlueStore_1_1Blob.html#ac15b0e0dc360a84370a05cf61cfd181a">BlueStore::Blob::id</a>)&#160;</td><td class="memItemRight" valign="bottom"><b>allocate_spanning_blob_id</b> ()</td></tr>
<tr class="separator:ab9031ef7f8d898eecf5f5cccb93fa80d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d7b004f13bde167c32bc3ff6335ecf6"><td class="memItemLeft" align="right" valign="top"><a id="a0d7b004f13bde167c32bc3ff6335ecf6"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>reshard</b> (KeyValueDB *db, KeyValueDB::Transaction t)</td></tr>
<tr class="separator:a0d7b004f13bde167c32bc3ff6335ecf6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1b52289df37249a6fe27888ff4c4d91"><td class="memItemLeft" align="right" valign="top"><a id="ab1b52289df37249a6fe27888ff4c4d91"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#ab1b52289df37249a6fe27888ff4c4d91">init_shards</a> (bool loaded, bool dirty)</td></tr>
<tr class="memdesc:ab1b52289df37249a6fe27888ff4c4d91"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize Shards from the onode <br /></td></tr>
<tr class="separator:ab1b52289df37249a6fe27888ff4c4d91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a041910135e78849b6b896447c5ef41de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a041910135e78849b6b896447c5ef41de">seek_shard</a> (uint32_t offset)</td></tr>
<tr class="separator:a041910135e78849b6b896447c5ef41de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24c56e20ec1e40bdb245e7c2b7ffdfa9"><td class="memItemLeft" align="right" valign="top"><a id="a24c56e20ec1e40bdb245e7c2b7ffdfa9"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a24c56e20ec1e40bdb245e7c2b7ffdfa9">spans_shard</a> (uint32_t offset, uint32_t length)</td></tr>
<tr class="memdesc:a24c56e20ec1e40bdb245e7c2b7ffdfa9"><td class="mdescLeft">&#160;</td><td class="mdescRight">check if a range spans a shard <br /></td></tr>
<tr class="separator:a24c56e20ec1e40bdb245e7c2b7ffdfa9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad94806141ffc43467cf6bbff6b7c4a0a"><td class="memItemLeft" align="right" valign="top"><a id="ad94806141ffc43467cf6bbff6b7c4a0a"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#ad94806141ffc43467cf6bbff6b7c4a0a">fault_range</a> (KeyValueDB *db, uint32_t offset, uint32_t length)</td></tr>
<tr class="memdesc:ad94806141ffc43467cf6bbff6b7c4a0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">ensure that a range of the map is loaded <br /></td></tr>
<tr class="separator:ad94806141ffc43467cf6bbff6b7c4a0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac468546a6853777634dc3abd2f7591a2"><td class="memItemLeft" align="right" valign="top"><a id="ac468546a6853777634dc3abd2f7591a2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#ac468546a6853777634dc3abd2f7591a2">dirty_range</a> (uint32_t offset, uint32_t length)</td></tr>
<tr class="memdesc:ac468546a6853777634dc3abd2f7591a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">ensure a range of the map is marked dirty <br /></td></tr>
<tr class="separator:ac468546a6853777634dc3abd2f7591a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7750f76dfc83cae4e47297051ce03c8"><td class="memItemLeft" align="right" valign="top"><a id="ab7750f76dfc83cae4e47297051ce03c8"></a>
extent_map_t::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#ab7750f76dfc83cae4e47297051ce03c8">find</a> (uint64_t offset)</td></tr>
<tr class="memdesc:ab7750f76dfc83cae4e47297051ce03c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">for seek_lextent test <br /></td></tr>
<tr class="separator:ab7750f76dfc83cae4e47297051ce03c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6695477d3b00471ae2d0540c9e84e95"><td class="memItemLeft" align="right" valign="top"><a id="ae6695477d3b00471ae2d0540c9e84e95"></a>
extent_map_t::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#ae6695477d3b00471ae2d0540c9e84e95">seek_lextent</a> (uint64_t offset)</td></tr>
<tr class="memdesc:ae6695477d3b00471ae2d0540c9e84e95"><td class="mdescLeft">&#160;</td><td class="mdescRight">seek to the first lextent including or after offset <br /></td></tr>
<tr class="separator:ae6695477d3b00471ae2d0540c9e84e95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4d27214ec3bcef7eda91ab228cf22a9"><td class="memItemLeft" align="right" valign="top"><a id="ac4d27214ec3bcef7eda91ab228cf22a9"></a>
extent_map_t::const_iterator&#160;</td><td class="memItemRight" valign="bottom"><b>seek_lextent</b> (uint64_t offset) const</td></tr>
<tr class="separator:ac4d27214ec3bcef7eda91ab228cf22a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f617e433bbf71d7ba21494a95e74a98"><td class="memItemLeft" align="right" valign="top"><a id="a1f617e433bbf71d7ba21494a95e74a98"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a1f617e433bbf71d7ba21494a95e74a98">add</a> (uint32_t lo, uint32_t o, uint32_t l, BlobRef &amp;b)</td></tr>
<tr class="memdesc:a1f617e433bbf71d7ba21494a95e74a98"><td class="mdescLeft">&#160;</td><td class="mdescRight">add a new <a class="el" href="structBlueStore_1_1Extent.html">Extent</a> <br /></td></tr>
<tr class="separator:a1f617e433bbf71d7ba21494a95e74a98"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60577c1b6863b973b9468036e04cf479"><td class="memItemLeft" align="right" valign="top"><a id="a60577c1b6863b973b9468036e04cf479"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a60577c1b6863b973b9468036e04cf479">rm</a> (extent_map_t::iterator p)</td></tr>
<tr class="memdesc:a60577c1b6863b973b9468036e04cf479"><td class="mdescLeft">&#160;</td><td class="mdescRight">remove (and delete) an <a class="el" href="structBlueStore_1_1Extent.html">Extent</a> <br /></td></tr>
<tr class="separator:a60577c1b6863b973b9468036e04cf479"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50f0298afed02f9b6855043df8de8d02"><td class="memItemLeft" align="right" valign="top"><a id="a50f0298afed02f9b6855043df8de8d02"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>has_any_lextents</b> (uint64_t offset, uint64_t length)</td></tr>
<tr class="separator:a50f0298afed02f9b6855043df8de8d02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad89058438f3d0f29c93b8b08cb348ae7"><td class="memItemLeft" align="right" valign="top"><a id="ad89058438f3d0f29c93b8b08cb348ae7"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#ad89058438f3d0f29c93b8b08cb348ae7">compress_extent_map</a> (uint64_t offset, uint64_t length)</td></tr>
<tr class="memdesc:ad89058438f3d0f29c93b8b08cb348ae7"><td class="mdescLeft">&#160;</td><td class="mdescRight">consolidate adjacent lextents in extent_map <br /></td></tr>
<tr class="separator:ad89058438f3d0f29c93b8b08cb348ae7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a013096eadeb574d6c290f15193697032"><td class="memItemLeft" align="right" valign="top"><a id="a013096eadeb574d6c290f15193697032"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a013096eadeb574d6c290f15193697032">punch_hole</a> (CollectionRef &amp;c, uint64_t offset, uint64_t length, old_extent_map_t *old_extents)</td></tr>
<tr class="memdesc:a013096eadeb574d6c290f15193697032"><td class="mdescLeft">&#160;</td><td class="mdescRight">punch a logical hole. add lextents to deref to target list. <br /></td></tr>
<tr class="separator:a013096eadeb574d6c290f15193697032"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed21af7bacac22edf52efe4e97ac19ee"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structBlueStore_1_1Extent.html">Extent</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#aed21af7bacac22edf52efe4e97ac19ee">set_lextent</a> (CollectionRef &amp;c, uint64_t logical_offset, uint64_t offset, uint64_t length, BlobRef b, old_extent_map_t *old_extents)</td></tr>
<tr class="separator:aed21af7bacac22edf52efe4e97ac19ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78b404ee980b0972b5fabc21a9622c19"><td class="memItemLeft" align="right" valign="top"><a id="a78b404ee980b0972b5fabc21a9622c19"></a>
BlobRef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a78b404ee980b0972b5fabc21a9622c19">split_blob</a> (BlobRef lb, uint32_t blob_offset, uint32_t pos)</td></tr>
<tr class="memdesc:a78b404ee980b0972b5fabc21a9622c19"><td class="mdescLeft">&#160;</td><td class="mdescRight">split a blob (and referring extents) <br /></td></tr>
<tr class="separator:a78b404ee980b0972b5fabc21a9622c19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e35997271a72cac436a7a6acb8f75e6"><td class="memItemLeft" align="right" valign="top">debug_au_vector_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a3e35997271a72cac436a7a6acb8f75e6">debug_list_disk_layout</a> ()</td></tr>
<tr class="separator:a3e35997271a72cac436a7a6acb8f75e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a4a1c2b614b6d6ec926047405909c5a90"><td class="memItemLeft" align="right" valign="top"><a id="a4a1c2b614b6d6ec926047405909c5a90"></a>
<a class="el" href="structBlueStore_1_1Onode.html">Onode</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>onode</b></td></tr>
<tr class="separator:a4a1c2b614b6d6ec926047405909c5a90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eb7baebe12a7e7c4debcc204acfd45d"><td class="memItemLeft" align="right" valign="top"><a id="a5eb7baebe12a7e7c4debcc204acfd45d"></a>
extent_map_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a5eb7baebe12a7e7c4debcc204acfd45d">extent_map</a></td></tr>
<tr class="memdesc:a5eb7baebe12a7e7c4debcc204acfd45d"><td class="mdescLeft">&#160;</td><td class="mdescRight">map of Extents to Blobs <br /></td></tr>
<tr class="separator:a5eb7baebe12a7e7c4debcc204acfd45d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cf19e80b926084145d9a25df68a0103"><td class="memItemLeft" align="right" valign="top"><a id="a3cf19e80b926084145d9a25df68a0103"></a>
blob_map_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a3cf19e80b926084145d9a25df68a0103">spanning_blob_map</a></td></tr>
<tr class="memdesc:a3cf19e80b926084145d9a25df68a0103"><td class="mdescLeft">&#160;</td><td class="mdescRight">blobs that span shards <br /></td></tr>
<tr class="separator:a3cf19e80b926084145d9a25df68a0103"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a49b585047841433b9f98e75aa27980"><td class="memItemLeft" align="right" valign="top"><a id="a4a49b585047841433b9f98e75aa27980"></a>
mempool::bluestore_cache_meta::vector&lt; <a class="el" href="structBlueStore_1_1ExtentMap_1_1Shard.html">Shard</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#a4a49b585047841433b9f98e75aa27980">shards</a></td></tr>
<tr class="memdesc:a4a49b585047841433b9f98e75aa27980"><td class="mdescLeft">&#160;</td><td class="mdescRight">shards <br /></td></tr>
<tr class="separator:a4a49b585047841433b9f98e75aa27980"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb0c4952f8b581703c3e98db6d511996"><td class="memItemLeft" align="right" valign="top"><a id="abb0c4952f8b581703c3e98db6d511996"></a>
ceph::buffer::list&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBlueStore_1_1ExtentMap.html#abb0c4952f8b581703c3e98db6d511996">inline_bl</a></td></tr>
<tr class="memdesc:abb0c4952f8b581703c3e98db6d511996"><td class="mdescLeft">&#160;</td><td class="mdescRight">cached encoded map, if unsharded; empty=&gt;dirty <br /></td></tr>
<tr class="separator:abb0c4952f8b581703c3e98db6d511996"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aca8e5ece7d05a9333f0c6b2926cfd2"><td class="memItemLeft" align="right" valign="top"><a id="a2aca8e5ece7d05a9333f0c6b2926cfd2"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>needs_reshard_begin</b> = 0</td></tr>
<tr class="separator:a2aca8e5ece7d05a9333f0c6b2926cfd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea1c64c61cb7f8d0d9b6aabc89f765ad"><td class="memItemLeft" align="right" valign="top"><a id="aea1c64c61cb7f8d0d9b6aabc89f765ad"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><b>needs_reshard_end</b> = 0</td></tr>
<tr class="separator:aea1c64c61cb7f8d0d9b6aabc89f765ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a8461a5bf85afd2e6c2268f35eed47fa8"><td class="memItemLeft" align="right" valign="top"><a id="a8461a5bf85afd2e6c2268f35eed47fa8"></a>
std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><b>operator&lt;&lt;</b> (std::ostream &amp;out, const debug_au_vector_t &amp;auv)</td></tr>
<tr class="separator:a8461a5bf85afd2e6c2268f35eed47fa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>a sharded extent map, mapping offsets to lextents to blobs </p>

<p class="definition">Definition at line <a class="el" href="BlueStore_8h_source.html#l00897">897</a> of file <a class="el" href="BlueStore_8h_source.html">BlueStore.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a3e35997271a72cac436a7a6acb8f75e6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e35997271a72cac436a7a6acb8f75e6">&#9670;&nbsp;</a></span>debug_list_disk_layout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BlueStore::ExtentMap::debug_au_vector_t BlueStore::ExtentMap::debug_list_disk_layout </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Produces a sequence of allocation units representing logical offsets. If there is a discontinuity, it is encoded as disk_offset==-1. </p>

<p class="definition">Definition at line <a class="el" href="BlueStore_8cc_source.html#l04509">4509</a> of file <a class="el" href="BlueStore_8cc_source.html">BlueStore.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;{</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;  BlueStore::ExtentMap::debug_au_vector_t res;</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;  uint32_t l_pos = 0;</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span> ep = <a class="code" href="structBlueStore_1_1ExtentMap.html#a5eb7baebe12a7e7c4debcc204acfd45d">extent_map</a>.begin(); ep != <a class="code" href="structBlueStore_1_1ExtentMap.html#a5eb7baebe12a7e7c4debcc204acfd45d">extent_map</a>.end(); ++ep) {</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;    <span class="keywordflow">if</span> (l_pos &lt; ep-&gt;logical_offset) {</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;      <span class="comment">// a hole in logical mapping, mark it</span></div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;      res.emplace_back(-1ULL, ep-&gt;logical_offset - l_pos, 0, 0);</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;    }</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;    l_pos = ep-&gt;logical_offset + ep-&gt;length;</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;    <span class="keyword">const</span> <a class="code" href="structbluestore__blob__t.html">bluestore_blob_t</a>&amp; bblob = ep-&gt;blob-&gt;get_blob();</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;    uint32_t chunk_size = bblob.<a class="code" href="structbluestore__blob__t.html#aaac12582208373e4f07a263b8e768884">get_chunk_size</a>(onode-&gt;c-&gt;store-&gt;block_size);</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;    uint32_t length_left = ep-&gt;length;</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160; </div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;    <a class="code" href="structbluestore__extent__ref__map__t.html">bluestore_extent_ref_map_t</a>* ref_map = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;    <span class="keywordflow">if</span> (bblob.is_shared()) {</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;      ceph_assert(ep-&gt;blob-&gt;shared_blob-&gt;is_loaded());</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;      <a class="code" href="structbluestore__shared__blob__t.html">bluestore_shared_blob_t</a>* bsblob = ep-&gt;blob-&gt;shared_blob-&gt;persistent;</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;      ref_map = &amp;bsblob-&gt;<a class="code" href="structbluestore__shared__blob__t.html#acb4bd186a749b1e98f2c59ce52d45c1a">ref_map</a>;</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;    }</div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160; </div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;    <span class="keywordtype">unsigned</span> csum_i = 0;</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;    <span class="keywordtype">size_t</span> csum_cnt;</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;    uint32_t length;</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    <span class="keywordflow">if</span> (bblob.has_csum()) {</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;      csum_cnt = bblob.get_csum_count();</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;      uint32_t csum_chunk_size = bblob.get_csum_chunk_size();</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;      uint64_t csum_offset_align = p2align(ep-&gt;blob_offset, csum_chunk_size);</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;      csum_i = csum_offset_align / csum_chunk_size;</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;      <span class="comment">// size of first chunk</span></div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;      length = p2align(ep-&gt;blob_offset + csum_chunk_size, csum_chunk_size) - ep-&gt;blob_offset;</div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;      length = std::min&lt;uint32_t&gt;(length_left, length);</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;      <span class="keywordflow">if</span> (csum_chunk_size &lt; chunk_size) {</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;    chunk_size = csum_chunk_size;</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;      }</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;      length = p2align(ep-&gt;blob_offset + chunk_size, chunk_size) - ep-&gt;blob_offset;</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;      length = std::min&lt;uint32_t&gt;(length_left, length);</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;    }</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160; </div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    uint32_t bo = ep-&gt;blob_offset;</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;    <span class="keywordflow">while</span> (length_left &gt; 0) {</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      uint64_t csum_val = 0;</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <span class="keywordflow">if</span> (bblob.has_csum()) {</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;    ceph_assert(csum_cnt &gt; csum_i);</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;    csum_val = bblob.get_csum_item(csum_i);</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    ++csum_i;</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      }</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      <span class="comment">//extract AU from extents</span></div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;      uint64_t disk_extent_left; <span class="comment">// length till the end of disk extent</span></div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      uint64_t disk_offset = bblob.calc_offset(bo, &amp;disk_extent_left);</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;      <a class="code" href="structbluestore__extent__ref__map__t_1_1debug__len__cnt.html">bluestore_extent_ref_map_t::debug_len_cnt</a> l_c = {0, std::numeric_limits&lt;uint32_t&gt;::max()};</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;      <span class="keywordflow">if</span> (bblob.is_shared()) {</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;    l_c = ref_map-&gt;<a class="code" href="structbluestore__extent__ref__map__t.html#a069f62f0007553393aa1a0f80ff4a689">debug_peek</a>(disk_offset);</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;    <span class="keywordflow">if</span> (l_c.len &lt; length) {</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;      length = l_c.len;</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    }</div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;      }</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;      res.emplace_back(disk_offset, length, csum_val, l_c.cnt);</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      bo += length;</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;      length_left -= length;</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      length = chunk_size;</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;    };</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;  }</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;  <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;}</div>
<div class="ttc" id="astructBlueStore_1_1ExtentMap_html_a5eb7baebe12a7e7c4debcc204acfd45d"><div class="ttname"><a href="structBlueStore_1_1ExtentMap.html#a5eb7baebe12a7e7c4debcc204acfd45d">BlueStore::ExtentMap::extent_map</a></div><div class="ttdeci">extent_map_t extent_map</div><div class="ttdoc">map of Extents to Blobs</div><div class="ttdef"><b>Definition:</b> <a href="BlueStore_8h_source.html#l00899">BlueStore.h:899</a></div></div>
<div class="ttc" id="astructbluestore__blob__t_html"><div class="ttname"><a href="structbluestore__blob__t.html">bluestore_blob_t</a></div><div class="ttdoc">blob: a piece of data on disk</div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8h_source.html#l00464">bluestore_types.h:464</a></div></div>
<div class="ttc" id="astructbluestore__blob__t_html_aaac12582208373e4f07a263b8e768884"><div class="ttname"><a href="structbluestore__blob__t.html#aaac12582208373e4f07a263b8e768884">bluestore_blob_t::get_chunk_size</a></div><div class="ttdeci">uint64_t get_chunk_size(uint64_t dev_block_size) const</div><div class="ttdoc">return chunk (i.e. min readable block) size for the blob</div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8h_source.html#l00609">bluestore_types.h:609</a></div></div>
<div class="ttc" id="astructbluestore__extent__ref__map__t_1_1debug__len__cnt_html"><div class="ttname"><a href="structbluestore__extent__ref__map__t_1_1debug__len__cnt.html">bluestore_extent_ref_map_t::debug_len_cnt</a></div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8h_source.html#l00179">bluestore_types.h:179</a></div></div>
<div class="ttc" id="astructbluestore__extent__ref__map__t_html"><div class="ttname"><a href="structbluestore__extent__ref__map__t.html">bluestore_extent_ref_map_t</a></div><div class="ttdoc">extent_map: a std::map of reference counted extents</div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8h_source.html#l00152">bluestore_types.h:152</a></div></div>
<div class="ttc" id="astructbluestore__extent__ref__map__t_html_a069f62f0007553393aa1a0f80ff4a689"><div class="ttname"><a href="structbluestore__extent__ref__map__t.html#a069f62f0007553393aa1a0f80ff4a689">bluestore_extent_ref_map_t::debug_peek</a></div><div class="ttdeci">debug_len_cnt debug_peek(uint64_t offset) const</div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8cc_source.html#l00289">bluestore_types.cc:289</a></div></div>
<div class="ttc" id="astructbluestore__shared__blob__t_html"><div class="ttname"><a href="structbluestore__shared__blob__t.html">bluestore_shared_blob_t</a></div><div class="ttdoc">shared blob state</div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8h_source.html#l00971">bluestore_types.h:971</a></div></div>
<div class="ttc" id="astructbluestore__shared__blob__t_html_acb4bd186a749b1e98f2c59ce52d45c1a"><div class="ttname"><a href="structbluestore__shared__blob__t.html#acb4bd186a749b1e98f2c59ce52d45c1a">bluestore_shared_blob_t::ref_map</a></div><div class="ttdeci">bluestore_extent_ref_map_t ref_map</div><div class="ttdoc">shared blob id</div><div class="ttdef"><b>Definition:</b> <a href="bluestore__types_8h_source.html#l00974">bluestore_types.h:974</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a041910135e78849b6b896447c5ef41de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a041910135e78849b6b896447c5ef41de">&#9670;&nbsp;</a></span>seek_shard()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int BlueStore::ExtentMap::seek_shard </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>offset</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>return index of shard containing offset or -1 if not found </p>

<p class="definition">Definition at line <a class="el" href="BlueStore_8h_source.html#l01041">1041</a> of file <a class="el" href="BlueStore_8h_source.html">BlueStore.h</a>.</p>
<div class="fragment"><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                                    {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordtype">size_t</span> end = <a class="code" href="structBlueStore_1_1ExtentMap.html#a4a49b585047841433b9f98e75aa27980">shards</a>.size();</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="keywordtype">size_t</span> mid, left = 0;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="keywordtype">size_t</span> right = end; <span class="comment">// one passed the right end</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">while</span> (left &lt; right) {</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;        mid = left + (right - left) / 2;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        <span class="keywordflow">if</span> (offset &gt;= <a class="code" href="structBlueStore_1_1ExtentMap.html#a4a49b585047841433b9f98e75aa27980">shards</a>[mid].shard_info-&gt;offset) {</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;          <span class="keywordtype">size_t</span> next = mid + 1;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;          <span class="keywordflow">if</span> (next &gt;= end || offset &lt; <a class="code" href="structBlueStore_1_1ExtentMap.html#a4a49b585047841433b9f98e75aa27980">shards</a>[next].shard_info-&gt;offset)</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            <span class="keywordflow">return</span> mid;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;          <span class="comment">//continue to search forwards</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;          left = next;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          <span class="comment">//continue to search backwards</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;          right = mid;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160; </div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <span class="keywordflow">return</span> -1; <span class="comment">// not found</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    }</div>
<div class="ttc" id="astructBlueStore_1_1ExtentMap_html_a4a49b585047841433b9f98e75aa27980"><div class="ttname"><a href="structBlueStore_1_1ExtentMap.html#a4a49b585047841433b9f98e75aa27980">BlueStore::ExtentMap::shards</a></div><div class="ttdeci">mempool::bluestore_cache_meta::vector&lt; Shard &gt; shards</div><div class="ttdoc">shards</div><div class="ttdef"><b>Definition:</b> <a href="BlueStore_8h_source.html#l00910">BlueStore.h:910</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed21af7bacac22edf52efe4e97ac19ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed21af7bacac22edf52efe4e97ac19ee">&#9670;&nbsp;</a></span>set_lextent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structBlueStore_1_1Extent.html">BlueStore::Extent</a> * BlueStore::ExtentMap::set_lextent </td>
          <td>(</td>
          <td class="paramtype">CollectionRef &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>logical_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BlobRef&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">old_extent_map_t *&#160;</td>
          <td class="paramname"><em>old_extents</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>put new lextent into lextent_map overwriting existing ones if any and update references accordingly </p>

<p class="definition">Definition at line <a class="el" href="BlueStore_8cc_source.html#l04446">4446</a> of file <a class="el" href="BlueStore_8cc_source.html">BlueStore.cc</a>.</p>
<div class="fragment"><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;{</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;  <span class="comment">// We need to have completely initialized Blob to increment its ref counters.</span></div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;  ceph_assert(b-&gt;get_blob().get_logical_length() != 0);</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160; </div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;  <span class="comment">// Do get_ref prior to punch_hole to prevent from putting reused blob into </span></div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;  <span class="comment">// old_extents list if we overwre the blob totally</span></div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;  <span class="comment">// This might happen during WAL overwrite.</span></div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;  b-&gt;get_ref(onode-&gt;c, blob_offset, length);</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160; </div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;  <span class="keywordflow">if</span> (old_extents) {</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;    <a class="code" href="structBlueStore_1_1ExtentMap.html#a013096eadeb574d6c290f15193697032">punch_hole</a>(c, logical_offset, length, old_extents);</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;  }</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160; </div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;  Extent *le = <span class="keyword">new</span> Extent(logical_offset, blob_offset, length, b);</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;  <a class="code" href="structBlueStore_1_1ExtentMap.html#a5eb7baebe12a7e7c4debcc204acfd45d">extent_map</a>.insert(*le);</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;  maybe_reshard(logical_offset, logical_offset + length);</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;  <span class="keywordflow">return</span> le;</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;}</div>
<div class="ttc" id="astructBlueStore_1_1ExtentMap_html_a013096eadeb574d6c290f15193697032"><div class="ttname"><a href="structBlueStore_1_1ExtentMap.html#a013096eadeb574d6c290f15193697032">BlueStore::ExtentMap::punch_hole</a></div><div class="ttdeci">void punch_hole(CollectionRef &amp;c, uint64_t offset, uint64_t length, old_extent_map_t *old_extents)</div><div class="ttdoc">punch a logical hole. add lextents to deref to target list.</div><div class="ttdef"><b>Definition:</b> <a href="BlueStore_8cc_source.html#l04389">BlueStore.cc:4389</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this struct was generated from the following files:<ul>
<li><a class="el" href="BlueStore_8h_source.html">BlueStore.h</a></li>
<li><a class="el" href="BlueStore_8cc_source.html">BlueStore.cc</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
